#!/usr/bin/env perl

use warnings;
use strict;

my $usage="
convertHiCMatrix <subcommand> <...>
subcommand:	
compile	#compile a set of matrixes into one table
query	#retrieve interaction information for certain regions
";
@ARGV>=1 or die $usage,"\n";

my %chr2no=(
    'chr1' => '1', 'chr2' => '2', 'chr3' => '3', 'chr4' => '4',
    'chr5' => '5', 'chr6' => '6', 'chr7' => '7', 'chr8' => '8',
    'chr9' => '9', 'chr10' => '10', 'chr11' => '11', 'chr12' => '12',
    'chr13' => '13', 'chr14' => '14', 'chr15' => '15', 'chr16' => '16',
    'chr17' => '17', 'chr18' => '18', 'chr19' => '19', 'chr20' => '20',
    'chr21' => '21', 'chr22' => '22', 'chrx' => '23', 'chry' => '24',
    'chrmito' => '25', 'chrxy' => '26',
    '1' => '1', '2' => '2', '3' => '3', '4' => '4',
    '5' => '5', '6' => '6', '7' => '7', '8' => '8',
    '9' => '9', '10' => '10', '11' => '11', '12' => '12',
    '13' => '13', '14' => '14', '15' => '15', '16' => '16',
    '17' => '17', '18' => '18', '19' => '19', '20' => '20',
    '21' => '21', '22' => '22', 'x' => '23', 'y' => '24',
    'mito' => '25', 'xy' => '26',
);

my $subcommand=shift @ARGV;
if($subcommand eq "compile")
{
    &compile(@ARGV);
} elsif ($subcommand eq "query")
{
    &query(@ARGV);
} else
{
    die $usage,"\n";
}

#read a bunch of matrixes, put them into one table
sub compile
{

}
#retrieve values from certain regions
#if only one region is specified, return interaction values for all genome with that region
#if two regions are specified, only return interaction values between the two regions
sub query
{

}

#read raw interaction matrix
sub read_raw_matrix
{
    open IN,'<',$file or die "ERROR: failed to read $file: $!\n";
    while(<IN>)
    {
	next if /^#/;
	chomp;
	if($.==2) #header line
	@header=split;
	else
	{
#for data lines, the 1st column is row name
	    @f=split;
	    unshift @f
	}
    }
}

#read compiled matrix
sub read_compiled_matrix
{

}

#example output
=head
#hg18
	1:1-999999	1:1000000-1999999	...
1:1-999999	0	0	...
=cut

#example input
=head
#GMBothall.0.maq.ctg1.ctg22.1000000bp.hm.newtracks12forBryan.heatmap.matrix.tab
	HIC_bin1|hg18|chr22:1-999999	HIC_bin2|hg18|chr22:1000000-1999999	HIC_bin3|hg18|chr22:2000000-2999999	HIC_bin4|hg18|chr22:3000000-3999999	HIC_bin5|hg18|chr22:4000000-4999999	HIC_bin6|hg18|chr22:5000000-5999999	HIC_bin7|hg18|chr22:6000000-6999999	HIC_bin8|hg18|chr22:7000000-7999999	HIC_bin9|hg18|chr22:8000000-8999999	HIC_bin10|hg18|chr22:9000000-9999999	HIC_bin11|hg18|chr22:10000000-10999999	HIC_bin12|hg18|chr22:11000000-11999999	HIC_bin13|hg18|chr22:12000000-12999999	HIC_bin14|hg18|chr22:13000000-13999999	HIC_bin15|hg18|chr22:14000000-14999999	HIC_bin16|hg18|chr22:15000000-15999999	HIC_bin17|hg18|chr22:16000000-16999999	HIC_bin18|hg18|chr22:17000000-17999999	HIC_bin19|hg18|chr22:18000000-18999999	HIC_bin20|hg18|chr22:19000000-19999999	HIC_bin21|hg18|chr22:20000000-20999999	HIC_bin22|hg18|chr22:21000000-21999999	HIC_bin23|hg18|chr22:22000000-22999999	HIC_bin24|hg18|chr22:23000000-23999999	HIC_bin25|hg18|chr22:24000000-24999999	HIC_bin26|hg18|chr22:25000000-25999999	HIC_bin27|hg18|chr22:26000000-26999999	HIC_bin28|hg18|chr22:27000000-27999999	HIC_bin29|hg18|chr22:28000000-28999999	HIC_bin30|hg18|chr22:29000000-29999999	HIC_bin31|hg18|chr22:30000000-30999999	HIC_bin32|hg18|chr22:31000000-31999999	HIC_bin33|hg18|chr22:32000000-32999999	HIC_bin34|hg18|chr22:33000000-33999999	HIC_bin35|hg18|chr22:34000000-34999999	HIC_bin36|hg18|chr22:35000000-35999999	HIC_bin37|hg18|chr22:36000000-36999999	HIC_bin38|hg18|chr22:37000000-37999999	HIC_bin39|hg18|chr22:38000000-38999999	HIC_bin40|hg18|chr22:39000000-39999999	HIC_bin41|hg18|chr22:40000000-40999999	HIC_bin42|hg18|chr22:41000000-41999999	HIC_bin43|hg18|chr22:42000000-42999999	HIC_bin44|hg18|chr22:43000000-43999999	HIC_bin45|hg18|chr22:44000000-44999999	HIC_bin46|hg18|chr22:45000000-45999999	HIC_bin47|hg18|chr22:46000000-46999999	HIC_bin48|hg18|chr22:47000000-47999999	HIC_bin49|hg18|chr22:48000000-48999999	HIC_bin50|hg18|chr22:49000000-49691431	
HIC_bin1|hg18|chr1:1-999999	0	0	0	0	0	0	0	0	0	0	0	0	0	0	4.0	9.0	14.0	9.0	10.0	17.0	9.0	14.0	7.0	6.0	11.0	14.0	9.0	7.0	10.0	16.0	11.0	8.0	11.0	13.0	15.0	13.0	11.0	15.0	10.0	9.0	9.0	12.0	13.0	11.0	14.0	10.0	12.0	15.0	24.0	33.0
=cut
